## Generating clients .p12
# This isn't currently used as lan access is allowed without a ca, and 
# cloudflare is setup for mtls for public access.

# The clienttrafficpolicy is also required to enable mtls via gateway using this
# method.

# ```bash
# openssl genrsa -out tls.key 4096
# openssl req -x509 -new -nodes -key tls.key -sha256 -days 3650 \
#   -subj "/CN=ClientAuth CA" \
#   -out tls.crt \
#   -addext "basicConstraints=critical,CA:TRUE,pathlen=0" \
#   -addext "keyUsage=critical,keyCertSign,cRLSign"
# openssl genrsa -out client.key 4096
# openssl req -new -key client.key -out client.csr -subj "/CN=client-john" 
# basicConstraints=CA:FALSE
# keyUsage=critical, digitalSignature, keyEncipherment
# extendedKeyUsage=clientAuth
# subjectAltName=DNS:client-alice
# openssl x509 -req -in client.csr \
#   -CA tls.crt -CAkey tls.key -CAcreateserial \
#   -out client.crt -days 3650 -sha256 -extfile client.ext
# openssl pkcs12 -export -inkey client.key -in client.crt -certfile tls.crt -out client.p12
# ```


# ---
# apiVersion: bitnami.com/v1alpha1
# kind: SealedSecret
# metadata:
#   name: mtls-ca
#   namespace: envoy-gateway-system
#   annotations:
#     sealedsecrets.bitnami.com/cluster-wide: "true"
# spec:
#   encryptedData:
#     ca.crt: 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
#   template:
#     metadata:
#       name: mtls-ca
#       namespace: immich
#       annotations:
#         sealedsecrets.bitnami.com/cluster-wide: "true"
#     type: Opaque

# ---
# apiVersion: gateway.envoyproxy.io/v1alpha1
# kind: ClientTrafficPolicy
# metadata:
#   name: immich-mtls
#   namespace: envoy-gateway-system
# spec:
#   targetRefs:
#   - group: gateway.networking.k8s.io
#     kind: Gateway
#     name: eg
#     sectionName: https-immich
#   tls:
#     clientValidation:
#       caCertificateRefs:
#       - kind: "Secret"
#         group: ""
#         name: "mtls-ca"
